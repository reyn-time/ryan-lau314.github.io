---
layout: post
title: "Problem 044: Pentagon Numbers"
date: 2021-02-28 20:28:35 +0100
tags: euler
---
{% include mathjax.html %}
## Problem
Pentagonal numbers are generated by the formula, $P_n=n(3n−1)/2$. The first ten pentagonal numbers are:

<p style="text-align:center;">1, 5, 12, 22, 35, 51, 70, 92, 117, 145, ...</p>

It can be seen that $P_4 + P_7 = 22 + 70 = 92 = P_8$. However, their difference, 70 − 22 = 48, is not pentagonal.

Find the pair of pentagonal numbers, $P_j$ and $P_k$, for which their sum and difference are pentagonal and $D = \left\lvert P_k − P_j \right\rvert$ is minimised; what is the value of $D$?

## Solution
Similar to [Problem 042]({% post_url 2021-02-26-coded-triangle-numbers %}), we need an efficient way to figure out if a number is pentagonal. To do this we will have to figure out the subproblem:
> Express index n in terms of its corresponding pentagonal number P<sub>n</sub>.

Again, by completing the square:
\\\[\begin{align}
P_n &= \frac{1}{2}n(3n−1)\\\\\
2P_n &= 3n^2 - n\\\\\
2P_n &= 3\left(n^2 - \frac{1}{3}n\right)\\\\\
2P_n + \frac{1}{12} &= 3\left(n^2 - \frac{1}{3}n + \frac{1}{36}\right)\\\\\
2P_n + \frac{1}{12} &= 3\left(n-\frac{1}{6}\right)^2\\\\\
2P_n + \frac{1}{12} &= \frac{1}{12} (6n - 1)^2\\\\\
24P_n + 1 &= (6n - 1)^2\\\\\
6n - 1 &= \sqrt{24P_n + 1}\\\\\
n &= \frac{1}{6}\left(\sqrt{24P_n + 1} + 1\right)
\end{align}\\\] 

Hence, a nunber $p$ is pentagonal iff $\sqrt{24p + 1} + 1$ is an integer multiple of 6. 

Without loss of generality, let $P_j < P_k$ and $j < k$. We would like to find $i$, $j$, $k$, $l$ such that:
\\\[P_k - P_j = P_i \tag{1}\label{a}\\\]
\\\[P_j + P_k = P_l \tag{2}\label{b}\\\]
...while minimizing $i$.

Let $k = j + d$ where $d > 0$. From the definition of [pentagonal numbers](https://en.wikipedia.org/wiki/Pentagonal_number) on Wikipedia:
\\\[P_n = \sum_{t=1}^n (3t-2)\\\]

From $\ref{a}$:
\\\[
\begin{align}
P_k - P_j &= P_i\\\\\
P_{j+d} - P_j &= P_i\\\\\
\sum_{t=1}^{j+d} (3t-2) - \sum_{t=1}^{j} (3t-2) &= P_i\\\\\
\sum_{t=j+1}^{j+d} (3t-2) &= P_i\\\\\
\sum_{t=1}^{d} \left\[3(j+t)-2\right\] &= P_i\\\\\
3dj + \sum_{t=1}^{d} (3t-2) &= P_i\\\\\
3dj + P_d &= P_i\\\\\
j &= \frac{P_i - P_d}{3d} \tag{3}\label{c}
\end{align}
    \\\]

Equation $\ref{c}$ shows an interesting point: If $P_i$ is a pentagonal "difference" that satisifies $\ref{a}$, there exists $d < i$ such that $j = \frac{P_i - P_d}{3d}$ is an integer. That particular integer is the index of the smaller pentagon, $D_j$. 

How do we ensure $\ref{b}$ hold as well? Note that:
\\\[ P_l = P_j + P_k = P_j + (P_i + P_j) = P_i + 2P_j \tag{4}\label{d} \\\]
If we found out $P_i + 2P_j$ is a pentagonal number as well, we can be certain that the $P_i$ is a pentagonal difference that satisifies both $\ref{a}$ and $\ref{b}$.

Making use of $\ref{c}$ and $\ref{d}$, we can write a rather efficient program to find the minimum required $P_i$:
{% highlight python %}
from itertools import count


def nth_pentagon(n):
    return n * (3 * n - 1) // 2


def is_pentagon(n):
    return (((24 * n + 1) ** 0.5) + 1) % 6 == 0


for i in count(2):
    P_i = nth_pentagon(i)
    for d in range(1, i):
        P_d = nth_pentagon(d)
        j, remainder = divmod(P_i - P_d, 3 * d)
        if remainder == 0 and is_pentagon(2 * nth_pentagon(j) + P_i):
            P_j = nth_pentagon(j)
            P_k = nth_pentagon(j) + P_i
            print(f"{P_k} - {P_j} = {P_i}")
            print(f"{P_j} + {P_k} = {P_j + P_k}")
            exit(0)
{% endhighlight %}

Phew... probably the hardest question that I encountered on this site. 



